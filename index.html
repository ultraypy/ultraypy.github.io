<!DOCTYPE html>
<html>
<head>
    <title>License Generator</title>
    <!-- 引入必要的加密库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha3/0.9.0/sha3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/base85-js@1.0.4/dist/base85.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 8px; }
        input, button { padding: 10px; margin: 10px 0; width: 100%; }
        pre { background: white; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h2>License Generator</h2>
        <input type="text" id="machineCode" placeholder="输入机器码...">
        <button onclick="generateLicense()">生成许可证</button>
        <pre id="output"></pre>
    </div>

    <script>
        function generateLicense() {
            const machineCode = document.getElementById('machineCode').value;
            if (!machineCode) {
                alert("请输入机器码");
                return;
            }

            try {
                // 步骤1: SHA3-256哈希
                const shaBytes = new Uint8Array(sha3_256.array(machineCode));
                
                // 步骤2: 字节反转
                const reversed = Array.from(shaBytes).reverse();
                
                // 步骤3: 动态异或加密
                const xorKeys = [0x9F, 0xC7, 0x32, 0xAE];
                const xored = reversed.map((b, i) => b ^ xorKeys[i % 4]);
                
                // 步骤4: 双重Base85编码
                const encoder = new base85.Base85();
                const stage1 = encoder.encode(new Uint8Array(xored));
                const stage2 = encoder.encode(new TextEncoder().encode(stage1));
                
                // 步骤5: 字符替换
                const replacements = {
                    '0': 'Z', '2': 'X', '5': 'K',
                    'O': '3', 'I': '7', 'L': 'M'
                };
                const finalStr = stage2.split('').map(c => replacements[c] || c).join('');
                
                // 步骤6: 分组格式化
                const licenseKey = finalStr.match(/.{1,5}/g).join('-');
                
                document.getElementById('output').textContent = licenseKey;
            } catch (error) {
                alert(`生成失败: ${error.message}`);
            }
        }
    </script>
</body>
</html>
