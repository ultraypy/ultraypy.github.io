<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>License Key Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #result {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>许可证密钥生成器</h1>

    <label for="machine_code">请输入机器码：</label>
    <input type="text" id="machine_code" />
    <button onclick="generateLicenseKey()">生成许可证密钥</button>

    <div id="result"></div>

    <script>
        // 生成许可证密钥的函数
        function generateLicenseKey() {
            const machineCode = document.getElementById("machine_code").value;

            if (!machineCode) {
                alert("请输入机器码！");
                return;
            }

            // 步骤1：SHA3-256哈希处理
            const sha = sha256(machineCode);

            // 步骤2：字节顺序反转
            const reversedBytes = Array.from(sha).reverse();

            // 步骤3：动态异或加密（使用循环密钥）
            const xorKeys = [0x9F, 0xC7, 0x32, 0xAE];
            const xored = reversedBytes.map((b, i) => b ^ xorKeys[i % 4]);

            // 步骤4：双重Base85编码
            const stage1 = base85Encode(xored);
            const stage2 = base85Encode(stage1);

            // 步骤5：字符替换和格式化
            const replacements = {
                '0': 'Z', '2': 'X', '5': 'K',
                'O': '3', 'I': '7', 'L': 'M'
            };
            let finalStr = '';
            for (let c of stage2) {
                finalStr += replacements[c] || c;
            }

            // 步骤6：分组格式化（XXXXX-XXXXX...）
            const formattedKey = finalStr.match(/.{1,5}/g).join('-');

            document.getElementById("result").textContent = "许可证密钥: " + formattedKey;
        }

        // 用于计算SHA-256哈希的函数
        function sha256(str) {
            const hash = new TextEncoder().encode(str);
            return crypto.subtle.digest('SHA-256', hash).then(buffer => {
                return new Uint8Array(buffer);
            });
        }

        // Base85编码
        function base85Encode(input) {
            const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$%&()*+,-./:;<=>?@[]^_`{|}~'.split('');
            return input.map(byte => chars[byte % 85]).join('');
        }

    </script>

</body>
</html>
